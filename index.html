<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>JavaScript Unit Testing</title>
    <link rel="stylesheet" href="styles/styles.css"/>
  </head>
  <body class="cube">
    <article>
      <section>
        <h1>JavaScript<br>Unit Testing</h1><img src="images/dilberttestscript.jpg" width="597">
      </section>
      <section>
        <h2>Why should we automate client side testing?</h2>
        <div class="imagebox"><img src="images/bigquestionmark.png" width="150" class="float-left">
          <ul class="left-align">
            <li>
              <li class="list-oomph">Business logic is moving from server to client</li>
              <li class="list-oomph">The same benefits of server side testing transfer to client</li>
            </li>
          </ul>
        </div>
      </section>
      <section>
        <h2>Verify Expectations</h2>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph success"><i class="fa-li fa fa-thumbs-up fa-lg"></i>Happy path</li>
          <li class="list-oomph error"><i class="fa-li fa fa-thumbs-down fa-lg"></i>Error conditions</li>
          <li class="list-oomph alert"><i class="fa-li fa fa-times icon-padding fa-lg"></i>Invalid input</li>
          <li class="list-oomph unexpected"><i class="fa-li fa fa-warning icon-padding fa-lg"></i>Unexpected input</li>
        </ul>
      </section>
      <section>
        <h2>Prevent regressions</h2><img src="images/gorilla-with-mac.png" width="500">
      </section>
      <section>
        <h2>a.k.a. Whack-a-mole!</h2>
        <h3>Fix a bug, introduce another...</h3><img src="images/whackamole.jpg">
      </section>
      <section>
        <h2>Document Specs</h2>
        <h3>The only documentation that is kept up to date</h3>
        <pre><code class="language-javascript">// Assume passwordValidator module has been loaded...
describe('Password Validator', function() {
  it('Rejects short passwords', function() {
    var password = 'foo';
    var result = passwordValidator.isValid(password);
    expect(result).to.be(false);
  });
  it('Accepts password with mixed chars', function() {
    var password = 'abc123*&^%FEG'
    var result = passwordValidator.isValid(password);
    expect(result).to.be(true);
  });
});
</code></pre>
      </section>
      <section>
        <h2>Refactor with Confidence</h2><img src="images/confidence.png" width="370" height="400">
      </section>
      <section>
        <h2>Leads to cleaner code</h2>
        <div class="imagebox"><img src="images/clean-code-circle.png" width="200" height="200" class="img-padding"><img src="images/no-fish-circle.png" width="210" height="210" class="img-padding"></div>
        <h3>If it's hard to test, that's a code smell</h3>
      </section>
      <section>
        <h2>In the words of Uncle Bob...</h2>
        <p class="custom-quote"><i class="fa fa-quote-left fa-3x pull-left fa-border quote-border"></i>Why don't we clean up code that we know is messy? We're afraid we'll break it. But if we have the tests, we can be reasonably sure that the code is not broken, or that we'll detect the breakage immediately. If we have the tests we become fearless about making changes. If we see messy code, or an unclean structure, we can clean it without fear. Because of the tests, the code becomes malleable again. Because of the tests, software becomes soft again.</p><a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">The Three Rules of TDD</a>
      </section>
      <section>
        <h2>JavaScript Unit Testing Challenges</h2>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-cubes fa-lg"></i>What are the units?</li>
          <li class="list-oomph"><i class="fa-li fa fa-random fa-lg"></i>Asynchronous execution</li>
          <li class="list-oomph"><i class="fa-li fa fa-file-code-o fa-lg"></i>DOM manipulation</li>
          <li class="list-oomph"><i class="fa-li fa fa-cog fa-spin fa-lg"></i>What tools are available?</li>
        </ul>
      </section>
      <section>
        <h2 class="big-heading">What are the units?</h2>
        <pre><code class="language-javascript">$('button').click(function() {
  var query = $('input').text();
  // Validation rule: only search if we have a query of at least two chars
  if (query && query.length >= 2) {
    $.ajax(url: 'http://content.guardianapis.com/search?show-fields=all&q=' + query, success: function(data) {
      var items = data.response.results;
      for (i = 0; i < items; i++) {
        // Business rule: only show news items that have pictures
        if (item.fields.thumbnail) {
          // sentiment is a global!
          sentimentResult = sentiment.analyze(item.fields.trailText);
          $('table').append('&lt;tr&gt;')
          $('table').append('&lt;td&gt;' + item.fields.byline + '&lt;/tr&gt;')  // author
          $('table').append('&lt;td&gt;' + item.fields.trailText + '&lt;/tr&gt;')  // content
          $('table').append('&lt;td&gt;' + item.fields.thumbnail + '&lt;/tr&gt;')  // thumbnail
          $('table').append('&lt;td&gt;' + item.fields.webUrl + '&lt;/tr&gt;')  // url
          $('table').append('&lt;td&gt;' + item.fields.webTitle + '&lt;/tr&gt;')  // title
          $('table').append('&lt;td&gt;' + item.fields.webPublicationDate + '&lt;/tr&gt;')  // publishDate
          $('table').append('&lt;td&gt;' + sentimentResult + '&lt;/tr&gt;')  // sentiment analysis
          $('table').append('&lt;/tr&gt;')
        }
      }
    }, error: function(jqXHR, textStatus, errorThrown) {
      $('.errorBox').text(textStatus + ', ' + errorThrown);
      $('.errorBox').show();
    });
  }
});
</code></pre>
      </section>
      <section>
        <h2>Use a module system</h2>
        <pre><code class="language-javascript">// News Module
define(['jquery', 'sentiment'], function($, sentiment) {
  var init = function(config) { ... },
  var validate = function(query) { ... },
  var search = function(query) { ... },
  var display = function(loadInto, items) { ... }
});</code></pre>
        <h3>Break up logic into small functions<br>Declare dependencies in separate modules</h3>
      </section>
      <section>
        <h2>Stack for BDD Style Testing</h2>
        <ul class="left-align">
          <li></li>
          <li><a href="http://visionmedia.github.io/mocha/">Mocha test framework</a> describe... it...</li>
          <li><a href="http://chaijs.com/api/bdd/">Chai Assertion Library</a> expect... to...</li>
          <li><a href="http://sinonjs.org/docs/">Sinon.JS</a> spies, stubs, and mocks</li>
          <li><a href="http://karma-runner.github.io/0.12/intro/how-it-works.html">Karma Runner</a> Multiple browsers, reporters</li>
          <li><a href="https://github.com/karma-runner/grunt-karma">Grunt</a> Run automation, local and CI</li>
        </ul>
      </section>
      <section>
        <h2>Load module in a test</h2>
        <pre><code class="language-javascript">// News module is the fixture under test
define(['../news', 'jquery'], function(fixture, $) {
  describe('News Module', function() {
    it('Does something', function() {
      expect(fixture.someMethod()).to.equal('something');
    });
  });
});
</code></pre>
      </section>
      <section>
        <h2>Demo</h2>
        <h3>Simple function with inputs and output</h3>
        <ul class="left-align">
          <li></li>
          <li class="list-oomph">No dependencies</li>
          <li class="list-oomph">Synchronous</li>
          <li class="list-oomph">No side effects</li>
        </ul>
      </section>
      <!-- TODO Demo-->
      <section>
        <h2>Mock out dependencies</h2>
        <pre><code class="language-javascript">define(['../news', '../sentiment'], function(fixture, sentiment) {
  it('News conversion delegates to sentiment analysis', function() {
  
    var sentimentStub = sinon.stub(sentiment, 'analyze');
    sentimentStub.onCall(0).returns('positive');
    sentimentStub.onCall(2).returns('negative');
    
    var itemsFromApi = [{content: 'foo'}, {content: 'bar'}];
    var result = fixture.process(itemsFromApi);
    
    sinon.assert.calledwith(sentimentStub, 'foo')
    sinon.assert.calledwith(sentimentStub, 'bar')
  });
});
</code></pre>
      </section>
      <section>
        <h2>Demo</h2>
        <h3>Async execution with sinon stub and mocha done</h3><a href="https://github.com/danielabar/learn-js-test/blob/master/app/scripts/news.js">Source</a>var search = function(query)...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Spec</a>describe('Search', function()...
      </section>
      <section>
        <h2>Demo</h2>
        <h3>DOM manipulation with Karma html2js plugin</h3><a href="https://github.com/danielabar/learn-js-test/blob/master/app/scripts/news.js">Source</a>var display = function(loadInto, displayItems)...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Spec</a>describe('Display', function()...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/html/AppSpec.html">HTML snippet</a>
      </section>
      <section>
        <h2>Karma goodies</h2>
        <ul>
          <li></li>
          <li>Capture multiple browsers<img src="images/Chrome.png" width="30" height="30"><img src="images/Firefox.png" width="30" height="30"><img src="images/Safari.png" width="30" height="30"><img src="images/Opera.png" width="30" height="30"><img src="images/IE.png" width="30" height="30"></li>
          <li>Test from other devices<i class="fa fa-mobile icon-padding"></i><i class="fa fa-tablet icon-padding"></i></li>
          <li><a href="http://karma-runner.github.io/0.8/config/coverage.html">Coverage reporter</a></li>
          <li><a href="https://www.npmjs.org/search?q=karma">Many other plugins available</a></li>
        </ul>
      </section>
      <section>
        <h2>Further References</h2>
        <ul>
          <li>TBD...</li>
        </ul>
      </section>
    </article>
    <script src="scripts/scripts.js"></script>
  </body>
</html>