<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>JavaScript Unit Testing</title>
    <link rel="stylesheet" href="styles/styles.css"/>
  </head>
  <body class="cube">
    <article>
      <section>
        <h1>JavaScript<br>Unit Testing</h1><img src="images/dilberttestscript.jpg" width="597">
      </section>
      <section>
        <h2>Why should we automate client side testing?</h2>
        <div class="imagebox"><img src="images/bigquestionmark.png" width="150" class="float-left">
          <ul class="left-align">
            <li>
              <li class="list-oomph">Business logic is moving from server to client</li>
              <li class="list-oomph">The same benefits of server side testing transfer to client</li>
            </li>
          </ul>
        </div>
      </section>
      <section>
        <h2>Verify Expectations</h2>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph success"><i class="fa-li fa fa-thumbs-up fa-lg"></i>Happy path</li>
          <li class="list-oomph error"><i class="fa-li fa fa-thumbs-down fa-lg"></i>Error conditions</li>
          <li class="list-oomph alert"><i class="fa-li fa fa-times icon-padding fa-lg"></i>Invalid input</li>
          <li class="list-oomph unexpected"><i class="fa-li fa fa-warning icon-padding fa-lg"></i>Unexpected input</li>
        </ul>
      </section>
      <section>
        <h2>Prevent regressions</h2><img src="images/gorilla-with-mac.png" width="500">
      </section>
      <section>
        <h2>a.k.a. Whack-a-mole!</h2><img src="images/whackamole.jpg">
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph smell"><i class="fa-li fa fa-frown-o fa-lg"></i>Fix a bug, introduce another...</li>
        </ul>
      </section>
      <section>
        <h2>Document Specs</h2>
        <pre class="hack-height-2"><code class="language-javascript">describe('Password Validator', function() {
  it('Rejects short passwords', function() {
    var password = 'foo';
    var result = passwordValidator.isValid(password);
    expect(result).to.be(false);
  });
  it('Accepts password with mixed chars', function() {
    var password = 'abc123*&^%FEG'
    var result = passwordValidator.isValid(password);
    expect(result).to.be(true);
  });
});</code></pre>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-file-word-o"></i>The only documentation that is kept up to date</li>
        </ul>
      </section>
      <section>
        <h2>Refactor with Confidence</h2><img src="images/confidence.png" width="370" height="400">
      </section>
      <section>
        <h2>Leads to cleaner code</h2>
        <div class="imagebox"><img src="images/clean-code-circle.png" width="200" height="200" class="img-padding"><img src="images/no-fish-circle.png" width="210" height="210" class="img-padding"></div>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph smell"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>If it's hard to test, that's a smell!</li>
        </ul>
      </section>
      <section>
        <h2>In the words of Uncle Bob...</h2>
        <p class="custom-quote"><i class="fa fa-quote-left fa-3x pull-left fa-border quote-border"></i>Why don't we clean up code that we know is messy? We're afraid we'll break it. But if we have the tests, we can be reasonably sure that the code is not broken, or that we'll detect the breakage immediately. If we have the tests we become fearless about making changes. If we see messy code, or an unclean structure, we can clean it without fear. Because of the tests, the code becomes malleable again. Because of the tests, software becomes soft again.</p>
        <div class="custom-cite"><a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">The Three Rules of TDD</a></div>
      </section>
      <section>
        <h2>JavaScript Unit Testing Challenges</h2>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-cubes fa-lg"></i>What are the units?</li>
          <li class="list-oomph"><i class="fa-li fa fa-random fa-lg"></i>Asynchronous execution</li>
          <li class="list-oomph"><i class="fa-li fa fa-file-code-o fa-lg"></i>DOM manipulation</li>
          <li class="list-oomph"><i class="fa-li fa fa-cog fa-spin fa-lg"></i>What tools are available?</li>
        </ul>
      </section>
      <section>
        <h2 class="big-heading">What are the units?</h2>
        <pre><code class="language-javascript">$('button').click(function() {
  var query = $('input').text();
  if (query && query.length >= 2) {
    $.ajax(
        url: 'http://content.guardianapis.com/search?show-fields=all&q=' + query,
        success: function(data) {
          var items = data.response.results;
          for (i = 0; i < items; i++) {
            sentimentResult = sentiment.analyze(item.fields.trailText);
            $('table').append('&lt;tr&gt;')
            $('table').append('&lt;td&gt;' +
              item.fields.byline + '&lt;/tr&gt;');  //author
            $('table').append('&lt;td&gt;' +
              item.fields.trailText + '&lt;/tr&gt;');  //content
            $('table').append('&lt;td&gt;' +
              item.fields.thumbnail + '&lt;/tr&gt;');  //thumbnail
            $('table').append('&lt;td&gt;' +
              item.fields.webUrl + '&lt;/tr&gt;');  //url
            $('table').append('&lt;td&gt;' +
              item.fields.webTitle + '&lt;/tr&gt;'); //title
            $('table').append('&lt;td&gt;' +
              item.fields.webPublicationDate + '&lt;/tr&gt;');  //publishDate
            $('table').append('&lt;td&gt;' +
              sentimentResult + '&lt;/tr&gt;');  //sentiment analysis
            $('table').append('&lt;/tr&gt;')
          }
    }, error: function(jqXHR, textStatus, errorThrown) {
      $('.error').text(textStatus + ', ' + errorThrown);
      $('.error').show();
    });
  }
});
</code></pre>
      </section>
      <section>
        <h2>Use a module system</h2>
        <pre class="hack-height"><code class="language-javascript">// News Module
define(['jquery', 'sentiment'], function($, sentiment) {
  var init = function(config) { ... },
  var validate = function(query) { ... },
  var search = function(query) { ... },
  var process = function(items) { ... },
  var display = function(loadInto, items) { ... }
});</code></pre>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Break up logic into small functions</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Declare dependencies in separate modules</li>
        </ul>
      </section>
      <section>
        <h2>Stack for BDD Style Testing</h2>
        <h3>and Java comparisons</h3>
        <ul class="left-align">
          <li></li>
          <li><a href="http://visionmedia.github.io/mocha/">Mocha test framework</a> describe... it...</li>
          <li class="triangle">JUnit @Test, @Before, @After</li>
          <li><a href="http://chaijs.com/api/bdd/">Chai Assertion Library</a> expect... to...</li>
          <li class="triangle">JUnit assertTrue, assertEquals</li>
          <li><a href="http://sinonjs.org/docs/">Sinon.JS</a> spies, stubs, and mocks</li>
          <li class="triangle">JMock, Mockito, Hamcrest Matchers</li>
          <li><a href="http://jasmine.github.io/1.3/introduction.html">Jasmine</a> is an alternative that can be used in place of Mocha, Chai and Sinon</li>
        </ul>
      </section>
      <section>
        <h2>Stack for BDD Style Testing</h2>
        <ul class="left-align">
          <li><a href="http://karma-runner.github.io/0.12/intro/how-it-works.html">Karma Runner</a> Multiple browsers, reporters</li>
          <li class="triangle">No exact Java equivalent, sort of like org.junit.runner or using Maven to run tests</li>
          <li><a href="https://github.com/karma-runner/grunt-karma">Grunt</a> Command line task runner</li>
          <li class="triangle">Like Ant or Make</li>
        </ul>
      </section>
      <section>
        <h2>DEMO News Application</h2>
        <ul>
          <li><a href="http://danielabar.github.io/learn-js-test/">http://danielabar.github.io/learn-js-test/</a></li>
        </ul>
      </section>
      <section>
        <h2><a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Demo</a></h2>
        <h3>Test a simple function</h3>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>No dependencies</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Synchronous</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>No side effects</li>
        </ul>
      </section>
      <section>
        <h2><a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Demo</a></h2>
        <h3>Using Sinon to mock out dependency</h3>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Test one thing only</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Mock out everything else</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Verify interactions</li>
        </ul>
      </section>
      <section>
        <h2><a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Demo</a></h2>
        <h3>Asynchronous Execution</h3>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Use promises</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Use sinon to mock and replace function - resolve or reject</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Call done() to let Mocha know it should wait for completion</li>
        </ul>
      </section>
      <section>
        <h2><a href="https://github.com/danielabar/learn-js-test/blob/master/test/DisplaySpec.js">Demo</a></h2>
        <h3>DOM Manipulation</h3>
        <ul class="left-align fa-ul">
          <li></li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Use Karma html2js plugin</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Inject HTML snippet for code to operate on</li>
          <li class="list-oomph"><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Use jQuery to verify HTML snippet was modified</li>
        </ul>
      </section>
      <section>
        <h2>Karma Features</h2>
        <ul class="left-align">
          <li></li>
          <li class="list-oomph">Capture multiple browsers<img src="images/Chrome.png" width="30" height="30"><img src="images/Firefox.png" width="30" height="30"><img src="images/Safari.png" width="30" height="30"><img src="images/Opera.png" width="30" height="30"><img src="images/IE.png" width="30" height="30"></li>
          <li class="list-oomph">Test from other devices<i class="fa fa-mobile icon-padding"></i><i class="fa fa-tablet icon-padding"></i></li>
          <li class="list-oomph">Coverage reporter</li>
          <li class="list-oomph">Many other plugins available</li>
        </ul>
      </section>
      <section>
        <h2>Continuous Integration</h2>
        <ul>
          <li></li>
          <li class="list-oomph">Because developers are human</li>
          <li class="list-oomph">and sometimes forget...</li>
          <li class="list-oomph">to run the tests before pushing!<img src="images/mr-forgetful.png"></li>
        </ul>
      </section>
      <section>
        <h2>Continuous Integration</h2>
        <ul>
          <li><img src="images/ci.png" width="500" height="350"></li>
        </ul>
      </section>
      <section>
        <h2>Continuous Integration</h2>
        <ul class="left-align">
          <li class="list-oomph">Specify command line to run tests</li>
          <li class="list-oomph">Run tests in headless mode</li>
          <li class="list-oomph">Use PhantomJS</li>
          <li><img src="images/ghost.png" width="100" height="100" class="float-right"></li>
        </ul>
      </section>
      <section>
        <h2>Continuous Integration</h2>
        <pre><code class="language-javascript">// Gruntfile.js
karma: {
  ci: {
    configFile: 'karma.conf.js',
    singleRun: true,
    browsers: ['PhantomJS']
  }
}
grunt.registerTask('test', ['karma:ci']);</code></pre>
        <pre><code class="language-javascript">// package.json
"scripts": {
  "test": "grunt test"
}
</code></pre>
      </section>
      <section>
        <h2>Continuous Integration</h2>
        <h3>Configuration for<a href="http://docs.travis-ci.com/user/getting-started/"> Travis CI</a></h3>
        <pre><code class="language-javascript">// .travis.yml
language: node_js
node_js:
  - '0.10'
before_install:
  - npm install -g grunt-cli
  - npm install -g bower
install:
  - npm install
  - bower install</code></pre>
        <ul class="left-align">
          <li><a href="https://travis-ci.org/danielabar/learn-js-test/builds/31809623">Sample output</a></li>
        </ul>
      </section>
      <section>
        <h2>Exercises with<a href="http://danielabar.github.io/learn-js-test/"> Demo</a></h2>
        <ul class="left-align">
          <li class="list-oomph">Solve these problems with a test driven approach:</li>
        </ul>
        <ul class="left-align fa-ul">
          <li><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Don't allow all spaces as query</li>
          <li><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Don't call sentiment when content has more than 10 words</li>
          <li><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Add coverage for News 'execute' method and verify with coverage report</li>
          <li><i class="fa-li fa fa-arrow-circle-right fa-lg"></i>Display sentiment results in search results</li>
        </ul>
      </section>
      <section data-bespoke-state="emphatic"><img src="images/banner_qa.jpg" class="img-border"></section>
    </article>
    <script src="scripts/scripts.js"></script>
  </body>
</html>