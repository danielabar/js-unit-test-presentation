<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>JavaScript Unit Testing</title>
    <link rel="stylesheet" href="styles/styles.css"/>
  </head>
  <body class="cube">
    <article>
      <section>
        <h1>JavaScript Unit Testing</h1><img src="images/dilberttestscript.jpg" width="597">
      </section>
      <section>
        <h2>Why should we automate client side testing?</h2>
        <div class="imagebox"><img src="images/bigquestionmark.png" width="150" class="float-left">
          <div class="sidebar">Many of the same reasons we test our server side code</div>
        </div>
      </section>
      <section>
        <h2>Verify Expectations</h2>
        <ul>
          <li></li>
          <li class="list-oomph success">Happy path<i class="fa fa-thumbs-up icon-padding"></i></li>
          <li class="list-oomph error">Error conditions<i class="fa fa-thumbs-down icon-padding"></i></li>
          <li class="list-oomph alert">Invalid input<i class="fa fa-times icon-padding"></i></li>
          <li class="list-oomph unexpected">Unexpected input<i class="fa fa-warning icon-padding"></i></li>
        </ul>
      </section>
      <section>
        <h2>Prevent regressions</h2><img src="images/gorilla-callout.png" width="500">
      </section>
      <section>
        <h2>Also known as...</h2>
        <h2>Whack-a-mole!</h2><img src="images/whackamole.jpg">
      </section>
      <section>
        <h2>Document Specs</h2>
        <hr>
        <pre><code class="language-javascript">// Assume passwordValidator module has been loaded...
describe('Password Validator', function() {
  it('Rejects short passwords', function() {
    var password = 'foo';
    var result = passwordValidator.isValid(password);
    expect(result).to.be(false);
  });
  it('Accepts password with mixed chars', function() {
    var password = 'abc123*&^%FEG'
    var result = passwordValidator.isValid(password);
    expect(result).to.be(true);
  });
});
</code></pre>
      </section>
      <section>
        <h2>Refactor with Confidence</h2><img src="images/confidence.png" width="370" height="400">
      </section>
      <section>
        <h2>Leads to cleaner code</h2>
        <div class="imagebox"><img src="images/clean-code-circle.png" width="200" height="200" class="img-padding"><img src="images/no-fish-circle.png" width="210" height="210" class="img-padding"></div>
        <h3>If it's hard to test, that's a code smell</h3>
      </section>
      <section>
        <h2>In the words of Uncle Bob...</h2>
        <blockquote cite="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">Why don't we clean up code that we know is messy? We're afraid we'll break it. But if we have the tests, we can be reasonably sure that the code is not broken, or that we'll detect the breakage immediately. If we have the tests we become fearless about making changes. If we see messy code, or an unclean structure, we can clean it without fear. Because of the tests, the code becomes malleable again. Because of the tests, software becomes soft again.</blockquote>
      </section>
      <section>
        <h2>JavaScript specific testing challenges</h2>
        <ul>
          <li></li>
          <li class="list-oomph">What are the units?<i class="fa fa-cubes icon-padding fa-lg"></i></li>
          <li class="list-oomph">Asynchronous execution<i class="fa fa-exchange icon-padding"></i></li>
          <li class="list-oomph">DOM manipulation<i class="fa fa-file-code-o icon-padding"></i></li>
        </ul>
      </section>
      <section>
        <h2>What are the units?</h2>
        <pre><code class="language-javascript">$('button').click(function() {
  var query = $('input').text();
  // Validation rule: only search if we have a query of at least two chars
  if (query && query.length >= 2) {
    $.ajax(url: 'http://content.guardianapis.com/search?show-fields=all&q=' + query, success: function(data) {
      var items = data.response.results;
      for (i = 0; i < items; i++) {
        // Business rule: only show news items that have pictures
        if (item.fields.thumbnail) {
          // sentiment is a global!
          sentimentResult = sentiment.analyze(item.fields.trailText);
          $('table').append('&lt;tr&gt;')
          $('table').append('&lt;td&gt;' + item.fields.byline + '&lt;/tr&gt;')  // author
          $('table').append('&lt;td&gt;' + item.fields.trailText + '&lt;/tr&gt;')  // content
          $('table').append('&lt;td&gt;' + item.fields.thumbnail + '&lt;/tr&gt;')  // thumbnail
          $('table').append('&lt;td&gt;' + item.fields.webUrl + '&lt;/tr&gt;')  // url
          $('table').append('&lt;td&gt;' + item.fields.webTitle + '&lt;/tr&gt;')  // title
          $('table').append('&lt;td&gt;' + item.fields.webPublicationDate + '&lt;/tr&gt;')  // publishDate
          $('table').append('&lt;td&gt;' + sentimentResult + '&lt;/tr&gt;')  // sentiment analysis
          $('table').append('&lt;/tr&gt;')
        }
      }
    }, error: function(jqXHR, textStatus, errorThrown) {
      $('.errorBox').text(textStatus + ', ' + errorThrown);
      $('.errorBox').show();
    });
  }
});
</code></pre>
      </section>
      <section>
        <h2>Use a module system</h2>
        <h3>Break up logic into small functions, declare dependencies in separate modules</h3>
        <pre><code class="language-javascript">// News Module
define(['jquery', 'sentiment'], function($, sentiment) {
  var init = function(config) { ... },
  var validate = function(query) { ... },
  var search = function(query) { ... },
  var display = function(loadInto, items) { ... }
});
</code></pre>
      </section>
      <section>
        <h2>A stack for JS testing</h2>
        <ul>
          <li></li>
          <li><a href="http://visionmedia.github.io/mocha/">Mocha test framework</a> describe... it...</li>
          <li><a href="http://chaijs.com/api/bdd/">Chai Assertion Library</a> expect... to...</li>
          <li><a href="http://sinonjs.org/docs/">Sinon.JS</a> spies, stubs, and mocks</li>
          <li><a href="http://karma-runner.github.io/0.12/intro/how-it-works.html">Karma Runner</a> Multiple browsers, reporters</li>
        </ul>
      </section>
      <section>
        <h2>Load module in a test</h2>
        <pre><code class="language-javascript">// News module is the fixture under test
define(['../news', 'jquery'], function(fixture, $) {
  describe('News Module', function() {
    it('Does something', function() {
      expect(fixture.someMethod()).to.equal('something');
    });
  });
});
</code></pre>
      </section>
      <section>
        <h2>Demo</h2>
        <h3>Simple function with no dependencies</h3><a href="https://github.com/danielabar/learn-js-test/blob/master/app/scripts/news.js">Source</a>var validate = function(value)...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Spec</a>describe('Validate', function()...
      </section>
      <!-- TODO Demo-->
      <section>
        <h2>Mock out dependencies</h2>
        <pre><code class="language-javascript">define(['../news', '../sentiment'], function(fixture, sentiment) {
  it('News conversion delegates to sentiment analysis', function() {
  
    var sentimentStub = sinon.stub(sentiment, 'analyze');
    sentimentStub.onCall(0).returns('positive');
    sentimentStub.onCall(2).returns('negative');
    
    var itemsFromApi = [{content: 'foo'}, {content: 'bar'}];
    var result = fixture.process(itemsFromApi);
    
    sinon.assert.calledwith(sentimentStub, 'foo')
    sinon.assert.calledwith(sentimentStub, 'bar')
  });
});
</code></pre>
      </section>
      <section>
        <h2>Demo</h2>
        <h3>Async execution with sinon stub and mocha done</h3><a href="https://github.com/danielabar/learn-js-test/blob/master/app/scripts/news.js">Source</a>var search = function(query)...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Spec</a>describe('Search', function()...
      </section>
      <section>
        <h2>Demo</h2>
        <h3>DOM manipulation with Karma html2js plugin</h3><a href="https://github.com/danielabar/learn-js-test/blob/master/app/scripts/news.js">Source</a>var display = function(loadInto, displayItems)...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/NewsSpec.js">Spec</a>describe('Display', function()...<a href="https://github.com/danielabar/learn-js-test/blob/master/test/html/AppSpec.html">HTML snippet</a>
      </section>
      <section>
        <h2>Karma goodies</h2>
        <ul>
          <li></li>
          <li>Capture multiple browsers<img src="images/Chrome.png" width="30" height="30"><img src="images/Firefox.png" width="30" height="30"><img src="images/Safari.png" width="30" height="30"><img src="images/Opera.png" width="30" height="30"><img src="images/IE.png" width="30" height="30"></li>
          <li>Test from other devices<i class="fa fa-mobile icon-padding"></i><i class="fa fa-tablet icon-padding"></i></li>
          <li><a href="http://karma-runner.github.io/0.8/config/coverage.html">Coverage reporter</a></li>
          <li><a href="https://www.npmjs.org/search?q=karma">Many other plugins available</a></li>
        </ul>
      </section>
      <section>
        <h2>Further References</h2>
        <ul>
          <li>TBD...</li>
        </ul>
      </section>
    </article>
    <script src="scripts/scripts.js"></script>
  </body>
</html>